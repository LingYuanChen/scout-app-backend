name: PR Title Formatter

on:
  pull_request:
    types: [opened, edited, synchronize, reopened, labeled, unlabeled]

jobs:
  format-title:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const labels = pr.labels.map(l => l.name);

            // Emoji map with arrays for random selection
            const labelEmojis = {
              'enhancement': ['âœ¨', 'ğŸŒŸ', 'ğŸ’«'],
              'bug': ['ğŸ›', 'ğŸª²', 'ğŸ”'],
              'documentation': ['ğŸ“š', 'ğŸ“–', 'ğŸ“'],
              'dependencies': ['ğŸ“¦', 'ğŸ”§', 'âš™ï¸'],
              'github_actions': ['ğŸ‘·', 'ğŸ¤–', 'âš¡'],
              'test': ['ğŸ§ª', 'ğŸ”¬', 'ğŸ§®'],
              'refactor': ['ğŸ”§', 'â™»ï¸', 'ğŸ’¡'],
              'ci': ['âš™ï¸', 'ğŸ”„', 'ğŸ› ï¸'],
              'config': ['âš™ï¸', 'ğŸ”¨', 'ğŸ› ï¸'],
              'breaking': ['ğŸ’¥', 'ğŸš¨', 'âš ï¸'],
              'security': ['ğŸ”’', 'ğŸ›¡ï¸', 'ğŸ”'],
              'performance': ['âš¡ï¸', 'ğŸš€', 'ğŸ’¨']
            };

            // Get random emoji based on labels
            let emoji = '';
            for (const label of labels) {
              const labelEmoji = labelEmojis[label.toLowerCase()];
              if (labelEmoji) {
                // Randomly select one emoji from the array
                const randomIndex = Math.floor(Math.random() * labelEmoji.length);
                emoji = labelEmoji[randomIndex] + ' ';
                break;
              }
            }

            // Get current title without emoji
            let title = pr.title.replace(/^[^\w]*/, '').trim();

            // Create new title with emoji
            const newTitle = `${emoji}${title}`;

            // Update if different
            if (pr.title !== newTitle) {
              await github.rest.pulls.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: pr.number,
                title: newTitle
              });
            }
